// Copyright © 2023 OpenIM open source community. All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";
package openim.openchat.admin;

import "openchat/common/common.proto";
import "sdkws/sdkws.proto";
import "wrapperspb/wrapperspb.proto";

option go_package = "github.com/ammmnia/protocol/openchat/admin";

// login
message LoginReq {
  string account = 1;
  string password = 2;
}

message LoginResp {
  string adminAccount = 1;
  string adminToken = 2;
  string nickname = 3;
  string faceURL = 4;
  int32 level = 5;
  string adminUserID = 6;
}

message LogoutReq {
  string account = 1;
}

message LogoutResp {
}

message AddAdminAccountReq {
  string account = 1; //用户名
  string password = 2;
  string username = 4;  //姓名
  uint64 roleId = 5;
  string desc = 6;
  uint32 status = 7;
}

message AddAdminAccountResp {}

message AdminUpdateInfoReq {
  openim.protobuf.StringValue userId = 1;
  openim.protobuf.StringValue account = 2;
  openim.protobuf.StringValue password = 3;
  openim.protobuf.StringValue username = 4;
  openim.protobuf.UInt32Value status = 5;
  openim.protobuf.UInt64Value roleId = 6;
  openim.protobuf.StringValue desc = 7;
}

message AdminUpdateInfoResp {
  string userID = 1;
  string account = 2;
  string username = 3;
  string nickname = 4;
  string faceURL = 5;
}

message ChangePasswordReq {
  string password = 1;
}

message ChangePasswordResp {}

message GetAdminInfoReq {
  string userID = 1;
}

message ChangeAdminPasswordReq {
  string userID = 1;
  string currentPassword = 2;
  string newPassword = 3;
}

message ChangeAdminPasswordResp {}

message DelAdminAccountReq {
  repeated string userIDs = 1;
}

message DelAdminAccountResp {}

message SearchAdminAccountReq {
  openim.sdkws.RequestPagination pagination = 2;
  string userName = 3;
  uint64 roleId = 4;
  string opUserName = 5;
  uint32 status = 6;
  string startTime = 7;
  string endTime = 8;
}

message SearchAdminAccountResp {
  uint64 total = 1;
  uint64 pages = 2;
  repeated GetAdminInfoResp adminAccounts = 3;
}

message GetAdminInfoResp {
  string account = 2;
  string userName = 3;
  string faceURL = 4;
  string nickname = 5;
  string userID = 6;
  string desc = 7;
  int64 createTime = 8;
  uint64 roleId = 9;
  uint32 status = 10;
  string opUserName = 11;
  int64 opTime = 12;
}

message DisableAdminAccountReq {
  string userID = 1;
  uint32 status = 2;
}

message DisableAdminAccountResp {
}

// ################### Default Friend ###################

message AddDefaultFriendReq {
  repeated string userIDs = 1;
}

message AddDefaultFriendResp {}

message DelDefaultFriendReq {
  repeated string userIDs = 1;
}

message DelDefaultFriendResp {}

message FindDefaultFriendReq {}

message FindDefaultFriendResp {
  repeated string userIDs = 1;
}

message SearchDefaultFriendReq {
  string keyword = 1;
  openim.sdkws.RequestPagination pagination = 2;
}

message DefaultFriendAttribute {
  string userID = 1;
  int64 createTime = 2;
  openim.openchat.common.UserPublicInfo user = 3;
}

message SearchDefaultFriendResp {
  uint32 total = 1;
  repeated DefaultFriendAttribute users = 2;
}

// ################### DefaultGroup ###################

message AddDefaultGroupReq {
  repeated string groupIDs = 1;
}

message AddDefaultGroupResp {}

message DelDefaultGroupReq {
  repeated string groupIDs = 1;
}

message DelDefaultGroupResp {}

message FindDefaultGroupReq {}

message FindDefaultGroupResp {
  repeated string groupIDs = 1;
}

message SearchDefaultGroupReq {
  string keyword = 1;
  openim.sdkws.RequestPagination pagination = 2;
}

message GroupAttribute {
  string groupID = 1;
  int64 createTime = 2;
  openim.sdkws.GroupInfo group = 3;
}

message SearchDefaultGroupResp {
  uint32 total = 1;
  repeated string groupIDs = 2;
}

// ################### InvitationCode ###################

message AddInvitationCodeReq {
  repeated string codes = 1;
}

message AddInvitationCodeResp {}

message GenInvitationCodeReq {
  int32 len = 1;
  int32 num = 2;
  string chars = 3;
}

message GenInvitationCodeResp {}

message FindInvitationCodeReq {
  repeated string codes = 1;
}

message FindInvitationCodeResp {
  repeated InvitationRegister codes = 1;
}

message UseInvitationCodeReq {
  string code = 1;
  string userID = 2;
}

message UseInvitationCodeResp {}

message DelInvitationCodeReq {
  repeated string codes = 1;
}

message DelInvitationCodeResp {}

message InvitationRegister {
  string invitationCode = 1;
  int64 createTime = 2;
  string usedUserID = 3;
  openim.openchat.common.UserPublicInfo usedUser = 4;
}

message SearchInvitationCodeReq {
  int32 status = 1;
  repeated string userIDs = 2;
  repeated string codes = 3;
  string keyword = 4;
  openim.sdkws.RequestPagination pagination = 5;
}

message SearchInvitationCodeResp {
  uint32 total = 1;
  repeated InvitationRegister list = 2;
}

// ################### User Login IP Limit ###################

message SearchUserIPLimitLoginReq {
  string keyword = 1;
  openim.sdkws.RequestPagination pagination = 2;
}

message LimitUserLoginIP {
  string userID = 1;
  string ip = 2;
  int64 createTime = 3;
  openim.openchat.common.UserPublicInfo user = 4;
}

message SearchUserIPLimitLoginResp {
  uint32 total = 1;
  repeated LimitUserLoginIP limits = 2;
}

message UserIPLimitLogin {
  string userID = 1;
  string ip = 2;
}

message AddUserIPLimitLoginReq {
  repeated UserIPLimitLogin limits = 1;
}

message AddUserIPLimitLoginResp {}

message DelUserIPLimitLoginReq {
  repeated UserIPLimitLogin limits = 1;
}

message DelUserIPLimitLoginResp {}

// ################### User IP Limit ###################

message IPForbidden {
  string ip = 1;
  bool limitRegister = 2;
  bool limitLogin = 3;
  int64 createTime = 4;
}

message IPForbiddenAdd {
  string ip = 1;
  bool limitRegister = 2;
  bool limitLogin = 3;
}

message SearchIPForbiddenReq {
  string keyword = 1;
  int32 status = 2;
  openim.sdkws.RequestPagination pagination = 3;
}

message SearchIPForbiddenResp {
  uint32 total = 1;
  repeated IPForbidden forbiddens = 2;
}

message AddIPForbiddenReq {
  repeated IPForbiddenAdd forbiddens = 1;
}
message AddIPForbiddenResp {}

message DelIPForbiddenReq {
  repeated string ips = 1;
}
message DelIPForbiddenResp {}

// ################### User Limit ###################
message CheckRegisterForbiddenReq {
  string ip = 1;
}

message CheckRegisterForbiddenResp {}

message CheckLoginForbiddenReq {
  string ip = 1;
  string userID = 2;
}

message CheckLoginForbiddenResp {}

// ################### login out ###################
message CancellationUserReq {
  string userID = 1;
  string reason = 2;
}

message CancellationUserResp {}

// ################### Block User, Unblock User ###################
message BlockUserReq {
  string userID = 1;
  string reason = 2;
}

message BlockUserResp {}

message UnblockUserReq {
  repeated string userIDs = 1;
}

message UnblockUserResp {}

message SearchBlockUserReq {
  string keyword = 1;
  openim.sdkws.RequestPagination pagination = 2;
}

message BlockUserInfo {
  string userID = 1;
  string account = 2;
  string phoneNumber = 3;
  string areaCode = 4;
  string email = 5;
  string nickname = 6;
  string faceURL = 7;
  int32 gender = 8;
  string reason = 9;
  string opUserID = 10;
  int64 createTime = 11;
}

message SearchBlockUserResp {
  uint32 total = 1;
  repeated BlockUserInfo users = 2;
}

message FindUserBlockInfoReq {
  repeated string userIDs = 1;
}

message BlockInfo {
  string userID = 1;
  string reason = 2;
  string opUserID = 3;
  int64 createTime = 4;
}

message FindUserBlockInfoResp {
  repeated BlockInfo blocks = 2;
}

// ################### TOKEN ###################

message CreateTokenReq {
  string userID = 1;
  int32 userType = 32;
}

message CreateTokenResp {
  string token = 1;
}

message ParseTokenReq {
  string token = 1;
}

message ParseTokenResp {
  string userID = 1;
  int32 userType = 2;
  int64 expireTimeSeconds = 3;
}

message InvalidateTokenReq {
  string userID = 1;
}

message InvalidateTokenResp {}

// ################### mini program ###################

message AddAppletReq {
  string id = 1;
  string name = 2;
  string appID = 3;
  string icon = 4;
  string url = 5;
  string md5 = 6;
  int64 size = 7;
  string version = 8;
  uint32 priority = 9;
  uint32 status = 10;
  int64 createTime = 11;
}

message AddAppletResp {}

message DelAppletReq {
  repeated string appletIds = 1;
}

message DelAppletResp {}

message UpdateAppletReq {
  string id = 1;
  openim.protobuf.StringValue name = 2;
  openim.protobuf.StringValue appID = 3;
  openim.protobuf.StringValue icon = 4;
  openim.protobuf.StringValue url = 5;
  openim.protobuf.StringValue md5 = 6;
  openim.protobuf.Int64Value size = 7;
  openim.protobuf.StringValue version = 8;
  openim.protobuf.UInt32Value priority = 9;
  openim.protobuf.UInt32Value status = 10;
  openim.protobuf.Int64Value createTime = 11;
}

message UpdateAppletResp {}

message FindAppletReq {}

message FindAppletResp {
  repeated openim.openchat.common.AppletInfo applets = 1;
}

message SearchAppletReq {
  string keyword = 1;
  openim.sdkws.RequestPagination pagination = 2;
}

message SearchAppletResp {
  uint32 total = 1;
  repeated openim.openchat.common.AppletInfo applets = 2;
}

message SetClientConfigReq {
  map<string, string> config = 1;
}

message SetClientConfigResp {}

message DelClientConfigReq {
  repeated string keys = 1;
}

message DelClientConfigResp {}

message GetClientConfigReq {}

message GetClientConfigResp {
  map<string, string> config = 1;
}

message GetUserTokenReq {
  string userID = 1;
}

message GetUserTokenResp {
  map<string, int32> tokensMap = 1;
}

message UpdateMenuReq {
  string menuName = 1;
  uint32 menuType = 2;
  uint32 menuParentId = 3;
  uint64 sort = 4;
  string icon = 5;
  string path = 6;
  uint32 isCache = 7;
  uint32 status = 8;
  uint64 menuId = 9;
}

message MenuInfoReq {
  uint64 menuId = 1;
}

message AddMenuReq {
  string menuName = 1;
  uint32 menuType = 2;
  uint32 menuParentId = 3;
  uint64 sort = 4;
  string icon = 5;
  string path = 6;
  uint32 isCache = 7;
  uint32 status = 8;
  string desc = 9;
}

message DelMenuReq {
  uint64 menuId = 1;
}

message UpdateMenuResp{

}

message SearchMenuReq {
  string menuName = 1;
  uint32 menuType = 2;
  string path = 6;
  uint32 status = 8;
  uint64 roleId = 9;
  string createBy = 10;
  string startTime = 11;
  string endTime = 12;
  openim.sdkws.RequestPagination pagination = 13;
}

message DisableMenuReq {
  uint64 menuId = 1;
}

message MenuInfoResp {
  string menuName = 1;
  uint32 menuType = 2;
  uint32 menuParentId = 3;
  uint64 sort = 4;
  string icon = 5;
  string path = 6;
  uint32 isCache = 7;
  uint32 status = 8;
  uint64 menuId = 9;
  string createBy = 10;
  int64 createTime = 11;
}

message AddMenuResp {
}

message DelMenuResp {
}

message SearchMenuResp {
  repeated MenuInfoResp menuInfo = 1;
  uint64 total = 2;
  uint64 pages = 3;
}

message DisableMenuResp {
}

message UpdateRoleReq {
  uint64 roleId = 1;
  string roleName = 2;
  string roleCode = 3;
  string desc = 4;
  uint32 status = 5;
}

message UpdateRoleResp {

}

message RoleInfoReq {
  uint64 roleId = 1;
}

message RoleInfoResp {
  uint64 roleId = 1;
  string roleName = 2;
  string roleCode = 3;
  string desc = 4;
  uint32 status = 5;
  string createBy = 6;
  int64 createTime = 7;
}

message AddRoleReq {
    string roleName = 1;
    string roleCode = 2;
    string desc = 3;
    uint32 status = 4;
}

message AddRoleResp {
  
}

// 删除角色，会删除该角色绑定的所有菜单，但是绑定该角色的用户不会删除
// 没有角色的用户不会展示任何菜单
message DelRoleReq {
   uint64 roleId = 1;
}

message DelRoleResp {

}

message SearchRoleReq {
  string roleName = 1;
  string roleCode = 2;
  string desc = 3;
  uint32 status = 4;
  string createBy = 5;
  string startTime = 6;
  string endTime = 7;
  openim.sdkws.RequestPagination pagination = 8;
}

message SearchRoleResp {
  repeated RoleInfoResp roleInfo = 1;
  uint64 total = 2;
  uint64 pages = 3;
}

message DisableRoleReq {
  uint64 roleId = 1;
}

message DisableRoleResp {

}

message UpdateRoleMenuReq {
  uint64 roleId = 1;
  repeated uint64 menuIds = 2;
}

message UpdateRoleMenuResp {

}

message RoleMenuInfoReq {
  uint64 roleId = 1;
}

message RoleMenuInfoResp {
  uint64 roleId = 1;
  repeated uint64 menuIds = 2;
}

message AddRoleMenuReq {
  uint64 roleId = 1;
  repeated uint64 menuIds = 2;
}

message AddRoleMenuResp {

}

// 删除该角色绑定的所有菜单
message DelRoleMenuReq {
  uint64 roleId = 1;
}

message DelRoleMenuResp {

}

// 跟新版本请求
message UpdateVersionReq {
  string ProductName = 1;
  string Platform = 2;
  string VersionCode = 3;
  string Desc = 4;
  string AndroidDownloadUrl = 5;
  string IosDownloadUrl = 6;
  uint32 ShowForceUpgrade = 7;
  uint32 ShowUpgradeTip = 8;
  uint64 versionId = 10;
}
message UpdateVersionResp {

}

message AddVersionReq {
  string ProductName = 1;
  string Platform = 2;
  string VersionCode = 3;
  string Desc = 4;
  string AndroidDownloadUrl = 5;
  string IosDownloadUrl = 6;
  uint32 ShowForceUpgrade = 7;
  uint32 ShowUpgradeTip = 8;
}
message AddVersionResp {

}
message SearchVersionReq {
  string ProductName = 1;
  string Platform = 2;
  string VersionCode = 3;
  uint32 ForceUpgrade = 4;
  string createBy = 5;
  string startTime = 6;
  string endTime = 7;
  openim.sdkws.RequestPagination pagination = 8;
}
message SearchVersionResp {
  uint64 total = 1;
  uint64 pages = 2;
  openim.sdkws.RequestPagination pagination = 3;
  repeated VersionInfoResp versions = 4;
}

message VersionInfoReq {
  uint64 versionId = 1;
}

message VersionInfoResp {
  string ProductName = 1;
  string Platform = 2;
  string VersionCode = 3;
  string Desc = 4;
  string AndroidDownloadUrl = 5;
  string IosDownloadUrl = 6;
  uint32 ShowForceUpgrade = 7;
  uint32 ShowUpgradeTip = 8;
  uint64 versionId = 10;
}

message DelVersionReq {
  uint64 versionId = 1;
}

message DelVersionResp {

}

service admin {
  // Login
  rpc Login(LoginReq) returns (LoginResp);
  rpc Logout(LogoutReq) returns (LogoutResp);
  rpc ChangePassword(ChangePasswordReq) returns (ChangePasswordResp);
  rpc AdminUpdateInfo(AdminUpdateInfoReq) returns (AdminUpdateInfoResp);
  // Get administrator information
  rpc GetAdminInfo(GetAdminInfoReq) returns (GetAdminInfoResp);
  rpc AddAdminAccount(AddAdminAccountReq) returns (AddAdminAccountResp);
  rpc ChangeAdminPassword(ChangeAdminPasswordReq) returns (ChangeAdminPasswordResp);
  rpc DelAdminAccount(DelAdminAccountReq) returns (DelAdminAccountResp);
  rpc SearchAdminAccount(SearchAdminAccountReq) returns (SearchAdminAccountResp);
  rpc DisableAdminAccount(DisableAdminAccountReq) returns (DisableAdminAccountResp);

  // Add Remove Get default friend list on registration
  rpc AddDefaultFriend(AddDefaultFriendReq) returns (AddDefaultFriendResp);
  rpc DelDefaultFriend(DelDefaultFriendReq) returns (DelDefaultFriendResp);
  rpc FindDefaultFriend(FindDefaultFriendReq) returns (FindDefaultFriendResp);
  rpc SearchDefaultFriend(SearchDefaultFriendReq) returns (SearchDefaultFriendResp);

  rpc AddDefaultGroup(AddDefaultGroupReq) returns (AddDefaultGroupResp);
  rpc DelDefaultGroup(DelDefaultGroupReq) returns (DelDefaultGroupResp);
  rpc FindDefaultGroup(FindDefaultGroupReq) returns (FindDefaultGroupResp);
  rpc SearchDefaultGroup(SearchDefaultGroupReq) returns (SearchDefaultGroupResp);

  // Invitation Code Generate Query Get
  rpc AddInvitationCode(AddInvitationCodeReq) returns (AddInvitationCodeResp);
  rpc GenInvitationCode(GenInvitationCodeReq) returns (GenInvitationCodeResp);
  rpc FindInvitationCode(FindInvitationCodeReq) returns (FindInvitationCodeResp);
  rpc UseInvitationCode(UseInvitationCodeReq) returns (UseInvitationCodeResp);
  rpc DelInvitationCode(DelInvitationCodeReq) returns (DelInvitationCodeResp);
  rpc SearchInvitationCode(SearchInvitationCodeReq) returns (SearchInvitationCodeResp);

  // User login ip limit Query Add Remove
  rpc SearchUserIPLimitLogin(SearchUserIPLimitLoginReq) returns (SearchUserIPLimitLoginResp);
  rpc AddUserIPLimitLogin(AddUserIPLimitLoginReq) returns (AddUserIPLimitLoginResp);
  rpc DelUserIPLimitLogin(DelUserIPLimitLoginReq) returns (DelUserIPLimitLoginResp);

  // Prohibit users from registering at certain ip Query Add Remove
  rpc SearchIPForbidden(SearchIPForbiddenReq) returns (SearchIPForbiddenResp);
  rpc AddIPForbidden(AddIPForbiddenReq) returns (AddIPForbiddenResp);
  rpc DelIPForbidden(DelIPForbiddenReq) returns (DelIPForbiddenResp);

  // User Management Related Add Block/Unblock Pull
  rpc CancellationUser(CancellationUserReq) returns (CancellationUserResp);
  rpc BlockUser(BlockUserReq) returns (BlockUserResp);
  rpc UnblockUser(UnblockUserReq) returns (UnblockUserResp);
  rpc SearchBlockUser(SearchBlockUserReq) returns (SearchBlockUserResp);
  rpc FindUserBlockInfo(FindUserBlockInfoReq) returns (FindUserBlockInfoResp);

  rpc CheckRegisterForbidden(CheckRegisterForbiddenReq) returns (CheckRegisterForbiddenResp);
  rpc CheckLoginForbidden(CheckLoginForbiddenReq) returns (CheckLoginForbiddenResp);

  // create token
  rpc CreateToken(CreateTokenReq) returns (CreateTokenResp);
  // parse token
  rpc ParseToken(ParseTokenReq) returns (ParseTokenResp);

  // app
  rpc AddApplet(AddAppletReq) returns (AddAppletResp);
  rpc DelApplet(DelAppletReq) returns (DelAppletResp);
  rpc UpdateApplet(UpdateAppletReq) returns (UpdateAppletResp);
  rpc FindApplet(FindAppletReq) returns (FindAppletResp);
  rpc SearchApplet(SearchAppletReq) returns (SearchAppletResp);

  // Client Configuration
  rpc GetClientConfig(GetClientConfigReq) returns (GetClientConfigResp);
  rpc SetClientConfig(SetClientConfigReq) returns (SetClientConfigResp);
  rpc DelClientConfig(DelClientConfigReq) returns (DelClientConfigResp);

  rpc GetUserToken(GetUserTokenReq) returns (GetUserTokenResp);

  // invalidate token
  rpc InvalidateToken(InvalidateTokenReq) returns (InvalidateTokenResp);

  // menu
  rpc UpdateMenuInfo(UpdateMenuReq) returns (UpdateMenuResp);
  rpc MenuInfo(MenuInfoReq) returns (MenuInfoResp);
  rpc AddMenu(AddMenuReq) returns (AddMenuResp);
  rpc DelMenu(DelMenuReq) returns (DelMenuResp);
  rpc SearchMenu(SearchMenuReq) returns (SearchMenuResp);
  rpc DisableMenu(DisableMenuReq) returns (DisableMenuResp);

  // role
  rpc UpdateRoleInfo(UpdateRoleReq) returns (UpdateRoleResp);
  rpc RoleInfo(RoleInfoReq) returns (RoleInfoResp);
  rpc AddRole(AddRoleReq) returns (AddRoleResp);
  rpc DelRole(DelRoleReq) returns (DelRoleResp);
  rpc SearchRole(SearchRoleReq) returns (SearchRoleResp);
  rpc DisableRole(DisableRoleReq) returns (DisableRoleResp);

  // role_menu
  rpc UpdateRoleMenuInfo(UpdateRoleMenuReq) returns (UpdateRoleMenuResp);
  rpc RoleMenuInfo(RoleMenuInfoReq) returns (RoleMenuInfoResp);
  rpc AddRoleMenu(AddRoleMenuReq) returns (AddRoleMenuResp);
  rpc DelRoleMenu(DelRoleMenuReq) returns (DelRoleMenuResp);

  // version
  rpc UpdateVersionInfo(UpdateVersionReq) returns (UpdateVersionResp);
  rpc VersionInfo(VersionInfoReq) returns (VersionInfoResp);
  rpc AddVersion(AddVersionReq) returns (AddVersionResp);
  rpc DelVersion(DelVersionReq) returns (DelVersionResp);
  rpc SearchVersion(SearchVersionReq) returns (SearchVersionResp);
}